<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mystyle.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
            crossorigin="anonymous"></script>
    <title>EgoraMap</title>
    <script>

        var map;
        var markers = [];
        //        var addURL = window.location.host + "/MyPage/westcampus.kml";
        //        var srckml = window.location.protocol + "//"+addURL.replace('//','/');
        var routePanelView = false;
        var srckml = "http://hardhill.esy.es/Routes.kml";
       
        console.log('loading: ' + document.readyState);
        $(document).ready(function () {

            initActions();
            initMap();
        })

        function initMap() {
            var myLatlng = { lat: 51.871491, lng: 107.731951 };
            var mapOptions = {
                center: myLatlng,
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.SATELLITE
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            loadKmlLayer(srckml, map);
            //            map.addListener('click', function (e) {
            //                placeMarkerAndPanTo(e.latLng, map);
            //                placeMarkerAndFields(e.latLng, map);
            //            });
        }

        function loadKmlLayer(srckml, map) {
            var kmlLayer = new google.maps.KmlLayer(srckml, {
                suppressInfoWindows: true,
                preserveViewport: false,
                map: map
            });
        }

        function initActions() {
            $("#routes-block").hide();
            $("#linkRoutes").click(function () {
                if (routePanelView) {
                    $("#routes-block").hide();
                    routePanelView = false;
                }
                else {
                    $("#routes-block").show();
                    routePanelView = true;
                    ViewAllRoutes();
                }
            });
            //изменение свойств индикатора загрузки
            $('#ajaxBusy').css({
                display: "none",
                margin: "0px",
                paddingLeft: "0px",
                paddingRight: "0px",
                paddingTop: "0px",
                paddingBottom: "0px",
                position: "absolute",
                top: "3px",
                width: "auto"
            });
            // события на аякс-загрузку
            $(document).ajaxStart(function () {
                $('#ajaxBusy').show();
            }).ajaxStop(function () {
                $('#ajaxBusy').hide();
            });
        }

        function ViewAllRoutes() {
            $.ajax({
                url: '/api/routes',
                type: 'GET',
                contentType: "application/json",
                success: function (data) {
                    var rows = "";
                    $("#route-body").empty();
                    $.each(data, function (index, vr) {
                        // добавляем полученные элементы в таблицу
                        rows += row(vr);
                    });
                    $("#route-body").append(rows);

                }
            });


            // создание строки для таблицы
            var row = function (vroute) {
                
                var strPhotki = "";
                var photki = vroute.photoPath;
                $.each(photki, function (index, pht) {
                    strPhotki += "<img src='/Files/Photo/" + pht + "'/>";
                });
                return "<div class='oneimage'><div class='titleimg'>" + vroute.name + "</div></div> <img class='mapimage' src='/Files/Img/" + vroute.imageMap + "' />" +
                    "<div class='photki'>" + strPhotki+ "</div>";
            }


        }

        


    </script>
</head>
<body>
    <nav class="navbar navbar-toggleable-md navbar-light bg-title1" role="navigation">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <a class="navbar-brand" rel="home" href="/" title="Egora Map Service">
            <img style="max-width:100px; margin-top: -7px;"
                 src="/img/logo.png">
        </a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <button class="nav-link" id="linkRoutes">Маршруты<span class="sr-only">(current)</span></button>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Вход</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Регистрация</a>
                </li>
            </ul>
        </div>
    </nav>
        <div class="panel-about">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6" id="map"></div>
                    <div class="col-lg-6"><p class="wellarticle">На этом сайте представлены самые популярные туристические трекинговые маршруты. Даны описания мест и фото от участников путешествий.</p></div>
                </div>
        </div>
    </div>
    <div id="ajaxBusy"><p><img src="img/wcursor.gif" /></p></div>
    <div id="routes-block">
         <div class="panel-route">
             <nav class="navbar navbar-toggleable navbar-light bg-faded bg-title2">
                 <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                     <span class="navbar-toggler-icon"></span>
                 </button>
                 <div class="navbar-brand" href="#">Маршруты</div>
                 <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                     <div class="navbar-nav ml-auto">
                         <!--<a class="nav-item nav-link active" href="#">Home <span class="sr-only">(current)</span></a>-->
                         <a class="nav-item nav-link" href="#">Добавить</a>
                         <a class="nav-item nav-link" href="#">Закрыть</a>

                     </div>
                 </div>
             </nav>
             <div class="container">
                
                <div id="route-body"></div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
            integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
            integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
            crossorigin="anonymous"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCI-xDAIte2eH2mehinBidaFHm3WhUkHAk&callback=initMap"
            async defer></script>
</body>
</html>